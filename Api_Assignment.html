<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Synced Cart (Fixed)</title>

<style>
body { font-family: Arial; }

#container {
  display: flex;
  gap: 20px;
}

#products {
  width: 65%;
  display: flex;
  flex-wrap: wrap;
}

.product {
  width: 180px;
  margin: 10px;
  padding: 10px;
  box-shadow: 1px 1px 5px gray;
  border-radius: 8px;
  text-align: center;
}

.product img {
  width: 100%;
  height: 120px;
  object-fit: cover;
}

.counter button {
  padding: 4px 8px;
  margin: 0 5px;
}

#cart {
  width: 35%;
  border-left: 2px solid;
  padding-left: 10px;
}

.cart-item {
  margin-bottom: 10px;
}
</style>
</head>

<body>

<h2>Products</h2>

<div id="container">
  <div id="products"></div>

  <div id="cart">
    <h3>Cart</h3>
    <div id="cartItems"></div>
    <h3>Total: ‚Çπ <span id="total">0</span></h3>
  </div>
</div>

<script>
let cart = [];

/* üîπ Load products */
fetch("https://dummyjson.com/products?limit=10")
  .then(res => res.json())
  .then(data => showProducts(data.products));

function showProducts(products) {
  products.forEach(p => {
    let div = document.createElement("div");
    div.className = "product";
    div.innerHTML = `
      <img src="${p.thumbnail}">
      <h4>${p.title}</h4>
      <p>‚Çπ${p.price}</p>
      <div id="action-${p.id}">
        <button onclick="add(${p.id}, ${p.price}, '${p.title}')">
          Add to Cart
        </button>
      </div>
    `;
    document.getElementById("products").appendChild(div);
  });
}

/* ‚ûï Add */
function add(id, price, title) {
  cart.push({ id, title, price, qty: 1 });
  updateProductUI(id);
}

/* ‚ûï Increase */
function plus(id) {
  cart.find(i => i.id === id).qty++;
  updateProductUI(id);
}

/* ‚ûñ Decrease */
function minus(id) {
  let index = cart.findIndex(i => i.id === id);

  cart[index].qty--;

  if (cart[index].qty === 0) {
    cart.splice(index, 1);
    resetProductUI(id);
  } else {
    updateProductUI(id);
  }

  renderCart();
}

/* üîÑ Update product UI */
function updateProductUI(id) {
  let item = cart.find(i => i.id === id);

  document.getElementById("action-" + id).innerHTML = `
    <div class="counter">
      <button onclick="minus(${id})">‚àí</button>
      <span>${item.qty}</span>
      <button onclick="plus(${id})">+</button>
    </div>
  `;

  renderCart();
}

/* üîÅ Reset product UI */
function resetProductUI(id) {
  let productDiv = document.getElementById("action-" + id);

  // find product price & title from DOM
  let parent = productDiv.closest(".product");
  let title = parent.querySelector("h4").innerText;
  let price = parent.querySelector("p").innerText.replace("‚Çπ", "");

  productDiv.innerHTML = `
    <button onclick="add(${id}, ${price}, '${title}')">
      Add to Cart
    </button>
  `;
}

/* üßæ Render Cart */
function renderCart() {
  let cartDiv = document.getElementById("cartItems");
  cartDiv.innerHTML = "";
  let total = 0;

  cart.forEach(item => {
    total += item.price * item.qty;
    cartDiv.innerHTML += `
      <div class="cart-item">
        ${item.title} ‚Äì ‚Çπ${item.price}
        <div class="counter">
          <button onclick="minus(${item.id})">‚àí</button>
          <span>${item.qty}</span>
          <button onclick="plus(${item.id})">+</button>
        </div>
      </div>
    `;
  });

  document.getElementById("total").innerText = total;
}
</script>

</body>
</html> 